#!/usr/bin/with-contenv bash


#======================================================================================================================
# Ensure PROXY_URI is set.
#======================================================================================================================

if [ -z "${PROXY_URI}" ] ; then
    bf-error "PROXY_URI must be set before requesting SSL certificates."
    exit 1
fi


#======================================================================================================================
# Ensure email is set.
#======================================================================================================================

if [ -z "${PROXY_LETS_ENCRYPT_EMAIL}" ] ; then
    bf-error "PROXY_LETS_ENCRYPT_EMAIL must be set before requesting SSL certificates."
    exit 1
fi


#======================================================================================================================
# Create arrays and include configuration.
#======================================================================================================================

source ${BF_INC}/proxy-load.conf.sh


#======================================================================================================================
# Check whether or not domains have been registered.
#======================================================================================================================

if [ "${#DOMAINS[@]}" = "0" ] ; then
    bf-error "No domains have been registered for SSL - please add them to /ssl/conf.sh."
    exit 1
fi


#======================================================================================================================
# Ensure certs directory exists.
#======================================================================================================================

[[ ! -d ${PROXY_SSL_CERTS} ]] && mkdir ${PROXY_SSL_CERTS}
