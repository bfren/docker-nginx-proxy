#!/bin/bash


#======================================================================================================================
# Ensure PROXY_DOMAIN is set.
#======================================================================================================================

if [ -z "${PROXY_DOMAIN}" ] ; then
    bf-error "PROXY_DOMAIN must be set before requesting SSL certificates." "inc/proxy-check.sh"
    exit 1
fi


#======================================================================================================================
# Ensure email is set.
#======================================================================================================================

if [ -z "${PROXY_LETS_ENCRYPT_EMAIL}" ] ; then
    bf-error "PROXY_LETS_ENCRYPT_EMAIL must be set before requesting SSL certificates." "inc/proxy-check.sh"
    exit 1
fi


#======================================================================================================================
# Load configuration (creates DOMAINS array).
#======================================================================================================================

source ${BF_INC}/proxy-load-conf.sh


#======================================================================================================================
# Check whether or not domains have been registered.
#======================================================================================================================

if [ "${#DOMAINS[*]}" = "0" ] ; then
    bf-error "No domains have been registered for SSL - please add them to /ssl/conf.json." "inc/proxy-check.sh"
    exit 1
fi


#======================================================================================================================
# Ensure certs directory exists.
#======================================================================================================================

[[ ! -d ${PROXY_SSL_CERTS} ]] && mkdir ${PROXY_SSL_CERTS}
