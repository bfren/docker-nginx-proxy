#======================================================================================================================
# WARNING: This file is generated. Do not make changes to this file.
# Changes will be overwritten the next time the container is started.
#
# Use environment variable PROXY_URI to change this file.
#
# Copyright (c) 2021 Ben Green <https://bcgdesign.com>
#======================================================================================================================

server {
    listen                              80 default_server;
    listen                              [::]:80 default_server;

    <%+ ./nginx-acme-challenge.part %>

    location / {
        <% if [ "${SSL_REDIRECT_INSECURE}" = "1" ] ; then -%>
        return                          301 https://<%= ${DOMAIN_NAME} %>$request_uri;
        <% else -%>
        root                            <%= ${WWW} %>;
        <% fi -%>
    }
}

server {
    listen                              443 ssl http2 default_server;
    listen                              [::]:443 ssl http2 default_server;

    add_header                          X-Clacks-Overhead "GNU Terry Pratchett";

    location / {
        root                            <%= ${WWW} %>;
        include                         helpers/proxy-secure-headers.conf;
        include                         <%= ${CUSTOM_CONF}/*.conf %>;
    }

    <%+ ./nginx-ssl-certs.part %>
}
