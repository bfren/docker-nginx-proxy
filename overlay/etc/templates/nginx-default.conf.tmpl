#======================================================================================================================
# WARNING: This file is generated. Do not make changes to this file.
# Changes will be overwritten the next time the container is started.
#
# Use environment variable PROXY_URI to change this file.
#
# Copyright (c) 2021 Ben Green <https://bcgdesign.com>
#======================================================================================================================

server {
    listen                              80 default_server;
    listen                              [::]:80 default_server;

    location ^~ /{{ getenv "ACME_CHALLENGE" }} {
        allow                           all;
        root                            {{ getenv "WWW" }};
    }

    location / {
        {{ if eq (getenv "SSL_REDIRECT_INSECURE") "1" }}
        return                          301 https://{{ getenv "DOMAIN_NAME" }}$request_uri;
        {{ else }}
        root                            {{ getenv "WWW" }};
        {{ end }}
    }
}

server {
    listen                              443 ssl http2 default_server;
    listen                              [::]:443 ssl http2 default_server;

    add_header                          X-Clacks-Overhead "GNU Terry Pratchett";

    location / {
        root                            {{ getenv "WWW" }};
        include                         helpers/proxy-secure-headers.conf;
        include                         {{ getenv "CUSTOM_CONF" }}/*.conf;
    }

    ssl_certificate                     {{ getenv "SSL_CERTS" }}/{{ getenv "DOMAIN_NAME" }}/fullchain.crt;
    ssl_certificate_key                 {{ getenv "SSL_CERTS" }}/{{ getenv "DOMAIN_NAME" }}.key;
    ssl_trusted_certificate             {{ getenv "SSL_CERTS" }}/{{ getenv "DOMAIN_NAME" }}/chain.crt;
    ssl_dhparam                         {{ getenv "SSL_DHPARAM" }};
}
